// Contract for doing difficult situation/biome combinations.
//   Author: nightingale

CONTRACT_TYPE
{
    name = FS_HardScience
    group = FieldResearch

    title = Field Research: Gather rare science results from @biome
    description = @isLanded ? @landStr : @waterStr
    synopsis = Run the requested experiments in while @situation.ToString().ToLower() at @biome.
    completedMessage = This is some great data that we've accumulated!

    // No more than one of these
    maxSimultaneous = 1

    prestige = Significant
    prestige = Exceptional

    // Always offered by the Field Research Team
    agent = Field Research Team

    targetBody = Prestige() == Significant ? HomeWorld() : OrbitedBodies().Where(cb => cb != HomeWorld()).Random()

    // Contract rewards
    rewardFunds = 25000.0 + Random(0.0, 5000.0)
    rewardReputation = Random(7.5, 10.0)

    DATA
    {
        type = string

        water = @isEve ? "whatever passes for water on Eve" : "water"
        waterStr = They say that it's difficult to find @water at @biome.  We've mapped out a few locations where there might be some.  Find a suitable spot and run some experiments.
        landStr = They say there isn't much land at @biome.  We've mapped out a few locations where there might be some.  Find a suitable spot and run some experiments.

        sitStr = @isLanded ? "Landing" : "Splashdown"
    }

    DATA
    {
        type = Biome
        biome = @ss0.Biome()
    }

    DATA
    {
        type = ExperimentSituations
        situation = @ss0.Situation()
    }

    DATA
    {
        type = bool
        isLanded = @situation == SrfLanded
        isEve = @targetBody == Eve
    }

    DATA
    {
        type = List<ScienceSubject>
        scienceSubjects = DifficultScienceSubjects().Where(s => s.CollectedScience() == 0.0 && s.Biome() == @biome && s.Situation() == @situation && s.Experiment() != @ss0.Experiment()).Random(2)
    }

    DATA
    {
        type = ScienceSubject
        ss0 = DifficultScienceSubjects().Where(s => s.RemainingScience() > 0.0 && s.CelestialBody() == @targetBody).Random()
        ss1 = @scienceSubjects.ElementAt(0)
        ss2 = @scienceSubjects.ElementAt(1)
    }

    DATA
    {
        type = List<Location>
        locations = @biome.DifficultLocations()
    }

    DATA
    {
        type = Location
        requiredValue = false

        loc0 = @locations.ElementAt(0)
        loc1 = @locations.ElementAt(1)
        loc2 = @locations.ElementAt(2)
    }

    DATA
    {
        type = ScienceRecoveryMethod
        recoveryMethod = @targetBody.IsHomeWorld() || @targetBody.Parent().IsHomeWorld() ? Ideal : RecoverOrTransmit
    }

    PARAMETER
    {
        name = CollectScience0
        type = CollectScience

        biome = @/ss0.Biome()
        situation = @/ss0.Situation()
        experiment = @/ss0.Experiment()
        recoveryMethod = @/recoveryMethod
    }

    PARAMETER
    {
        name = CollectScience1
        type = CollectScience

        biome = @/ss1.Biome()
        situation = @/ss1.Situation()
        experiment = @/ss1.Experiment()
        recoveryMethod = @/recoveryMethod
    }

    PARAMETER
    {
        name = CollectScience2
        type = CollectScience

        biome = @/ss2.Biome()
        situation = @/ss2.Situation()
        experiment = @/ss2.Experiment()
        recoveryMethod = @/recoveryMethod
    }

    BEHAVIOUR
    {
        name = WaypointGenerator
        type = WaypointGenerator

        WAYPOINT
        {
            name = Possible @/biome.Name() @/sitStr Location
            icon = ContractPacks/FieldResearch/Icons/research

            latitude = @/loc0.Latitude()
            longitude = @/loc0.Longitude()
            altitude = 0.0
        }

        WAYPOINT
        {
            name = Possible @/biome.Name() @/sitStr Location
            icon = ContractPacks/FieldResearch/Icons/research

            hidden = @/locations.Count() < 2

            latitude = @/loc1.Latitude()
            longitude = @/loc1.Longitude()
            altitude = 0.0
        }

        WAYPOINT
        {
            name = @/biome.Name() @/sitStr
            icon = ContractPacks/FieldResearch/Icons/research

            hidden = @/locations.Count() < 3

            latitude = @/loc2.Latitude()
            longitude = @/loc2.Longitude()
            altitude = 0.0
        }
    }

    REQUIREMENT
    {
        type = Orbit
        targetBody = Kerbin
    }
}
